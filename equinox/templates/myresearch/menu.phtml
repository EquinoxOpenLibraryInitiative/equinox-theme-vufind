<?php
  $user = $this->auth()->isLoggedIn();
  $patron = $user ? $this->auth()->getILSPatron() : false;
  $capabilityParams = $patron ? ['patron' => $patron] : [];
  $ilsOnline = ('ils-none' !== $this->ils()->getOfflineMode());
?>
<button class="close-offcanvas btn btn-link" data-toggle="offcanvas"><?=$this->transEsc('navigate_back') ?></button>
<h3><?=$this->transEsc('Your Account')?></h3>
<div class="myresearch-menu account-menu">
  <?php if ($this->userlist()->getMode() !== 'disabled'): ?>
    <a href="<?=$this->url('myresearch-favorites')?>"<?=$this->active == 'favorites' ? ' class="active"' : ''?>>
      <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M20.8096 7.23126L14.3629 6.29435L11.4811 0.451963C11.4024 0.292002 11.2729 0.162509 11.1129 0.0837985C10.7118 -0.114248 10.2243 0.0507907 10.0237 0.451963L7.14184 6.29435L0.695156 7.23126C0.517422 7.25665 0.354922 7.34044 0.230507 7.46739C0.0800975 7.62199 -0.00278512 7.82997 7.14643e-05 8.04565C0.00292805 8.26132 0.0912902 8.46703 0.245742 8.61759L4.91 13.1651L3.80805 19.5863C3.78221 19.7357 3.79874 19.8893 3.85576 20.0298C3.91279 20.1703 4.00803 20.2919 4.13068 20.381C4.25334 20.4701 4.3985 20.523 4.54971 20.5338C4.70092 20.5446 4.85212 20.5128 4.98617 20.442L10.7524 17.4104L16.5186 20.442C16.676 20.5258 16.8588 20.5537 17.034 20.5233C17.4758 20.4471 17.7729 20.0281 17.6967 19.5863L16.5948 13.1651L21.259 8.61759C21.386 8.49318 21.4698 8.33068 21.4952 8.15294C21.5637 7.70861 21.254 7.29728 20.8096 7.23126Z" fill="#26547C"/>
</svg>
 <?=$this->transEsc('Favorites')?>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkCapability('getMyTransactions', $capabilityParams)): ?>
    <a href="<?=$this->url('myresearch-checkedout')?>" class="flex checkedout<?=$this->active == 'checkedout' ? ' active' : ''?>">
      <span class="flex-col"><svg width="18" height="20" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M3.012 16H18V2C18 1.46957 17.7893 0.960859 17.4142 0.585786C17.0391 0.210714 16.5304 0 16 0H3C1.794 0 0 0.799 0 3V17C0 19.201 1.794 20 3 20H18V18H3.012C2.55 17.988 2 17.805 2 17C2 16.195 2.55 16.012 3.012 16ZM5 4H14V6H5V4Z" fill="#26547C"/>
</svg><?=$this->transEsc('Checked Out Items')?></span>
      <span class="checkedout-status status hidden"><?=$this->icon('spinner') ?></span>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkFunction('getMyTransactionHistory', $capabilityParams)): ?>
    <a href="<?=$this->url('myresearch-historicloans')?>"<?=$this->active == 'historicloans' ? ' class="active"' : ''?>>
      <i class="fa fa-fw fa-history" aria-hidden="true"></i> <?=$this->transEsc('Loan History')?>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkCapability('getMyHolds', $capabilityParams)): ?>
    <a href="<?=$this->url('holds-list')?>" class="flex<?=$this->active == 'holds' ? ' active' : ''?>">
      <span class="flex-col"><svg width="18" height="22" viewBox="0 0 18 22" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M1.5 22H0V0H18L13.65 7.07143L18 14.1429H1.5V22Z" fill="#26547C"/>
</svg><?=$this->transEsc('Holds and Recalls')?></span>
      <span class="holds-status status hidden"><?=$this->icon('spinner') ?></span>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkFunction('StorageRetrievalRequests', $capabilityParams)): ?>
    <a href="<?=$this->url('myresearch-storageretrievalrequests')?>" class="flex<?=$this->active == 'storageRetrievalRequests' ? ' active' : ''?>">
      <span class="flex-col"><svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 0H20.9V2.375H0V0ZM1.425 3.325V19H19.475V3.325H1.425ZM13.775 7.6H6.65V6.175H13.775V7.6Z" fill="#26547C"/>
</svg><?=$this->transEsc('Storage Retrieval Requests')?></span>
      <span class="storageretrievalrequests-status status hidden"><?=$this->icon('spinner') ?></span>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkFunction('ILLRequests', $capabilityParams)): ?>
    <a href="<?=$this->url('myresearch-illrequests')?>" class="flex<?=$this->active == 'ILLRequests' ? ' active' : ''?>">
      <span class="flex-col"><i class="fa fa-fw fa-exchange" aria-hidden="true"></i> <?=$this->transEsc('Interlibrary Loan Requests')?></span>
      <span class="illrequests-status status hidden"><?=$this->icon('spinner') ?></span>
    </a>
  <?php endif; ?>
  <?php if ($ilsOnline && $this->ils()->checkCapability('getMyFines', $capabilityParams)): ?>
    <a href="<?=$this->url('myresearch-fines')?>" class="flex<?=$this->active == 'fines' ? ' active' : ''?>">
      <?php
        // Use a "fines" icon based on the configured default currency symbol:
        $currency = strtolower($this->config()->get('config')->Site->defaultCurrency ?? 'usd');
      ?>
      <span class="flex-col"><svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11 0C4.92545 0 0 4.92545 0 11C0 17.0746 4.92545 22 11 22C17.0746 22 22 17.0746 22 11C22 4.92545 17.0746 0 11 0ZM11.5475 16.333L11.5525 17.1114C11.5525 17.2194 11.4641 17.3103 11.356 17.3103H10.6587C10.5507 17.3103 10.4623 17.2219 10.4623 17.1138V16.3429C8.28192 16.1808 7.25558 14.9384 7.14509 13.5879C7.13527 13.4725 7.22612 13.3743 7.34152 13.3743H8.47589C8.57165 13.3743 8.65513 13.4431 8.66987 13.5364C8.79509 14.3147 9.40156 14.8967 10.4893 15.0415V11.5377L9.88281 11.383C8.59866 11.0761 7.37589 10.2757 7.37589 8.61585C7.37589 6.82589 8.73616 5.86339 10.4746 5.69397V4.88371C10.4746 4.77567 10.5629 4.68728 10.671 4.68728H11.3609C11.469 4.68728 11.5574 4.77567 11.5574 4.88371V5.68661C13.2393 5.85603 14.5013 6.83817 14.6487 8.36786C14.6609 8.48326 14.5701 8.58393 14.4522 8.58393H13.3498C13.2516 8.58393 13.1681 8.51027 13.1558 8.41451C13.0576 7.69754 12.483 7.11317 11.5475 6.98549V10.283L12.1712 10.4279C13.7623 10.8208 14.8451 11.5819 14.8451 13.2859C14.8451 15.1348 13.4701 16.1661 11.5475 16.333ZM8.90312 8.5029C8.90312 9.12656 9.28862 9.61027 10.1185 9.90982C10.2339 9.95647 10.3493 9.9933 10.4868 10.0326V6.98795C9.5808 7.10335 8.90312 7.61161 8.90312 8.5029ZM11.7636 11.8225C11.6949 11.8078 11.6261 11.7906 11.5475 11.7685V15.0513C12.5935 14.958 13.3154 14.3835 13.3154 13.421C13.3154 12.6672 12.925 12.1761 11.7636 11.8225Z" fill="#26547C"/>
</svg><?=$this->transEsc('Fines')?></span>
      <span class="fines-status status hidden"><?=$this->icon('spinner') ?></span>
    </a>
  <?php endif; ?>
  <a href="<?=$this->url('myresearch-profile')?>"<?=$this->active == 'profile' ? ' class="active"' : ''?>>
  <svg width="20" height="19" viewBox="0 0 20 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M0 19C0 17.0803 0.762583 15.2393 2.11999 13.8819C3.4774 12.5245 5.31843 11.7619 7.2381 11.7619C9.15776 11.7619 10.9988 12.5245 12.3562 13.8819C13.7136 15.2393 14.4762 17.0803 14.4762 19H0ZM7.2381 10.8571C4.23881 10.8571 1.80952 8.42786 1.80952 5.42857C1.80952 2.42929 4.23881 0 7.2381 0C10.2374 0 12.6667 2.42929 12.6667 5.42857C12.6667 8.42786 10.2374 10.8571 7.2381 10.8571ZM16.2857 14.4762H19.9048V16.2857H16.2857V14.4762ZM13.5714 9.95238H19.9048V11.7619H13.5714V9.95238ZM15.381 5.42857H19.9048V7.2381H15.381V5.42857Z" fill="#26547C"/>
</svg><?=$this->transEsc('Profile')?>
  </a>
  <?php if ($ilsOnline && $user && $user->libraryCardsEnabled()): ?>
    <a href="<?=$this->url('librarycards-home')?>"<?=$this->active == 'librarycards' ? ' class="active"' : ''?>>
      <i class="fa fa-fw fa-barcode" aria-hidden="true"></i> <?=$this->transEsc('Library Cards')?>
    </a>
  <?php endif; ?>
  <?php if ($this->overdrive()->showMyContentLink()):?>
     <a href="<?=$this->url('overdrive-mycontent')?>"<?=$this->active == 'dgcontent' ? ' class="active"' : ''?>>
      <i class="fa fa-fw fa-download" aria-hidden="true"></i> <?=$this->transEsc('Overdrive Content')?>
    </a>
  <?php endif; ?>
  <?php if ($this->accountCapabilities()->getSavedSearchSetting() === 'enabled'): ?>
    <a href="<?=$this->url('search-history')?>?require_login"<?=$this->active == 'history' ? ' class="active"' : ''?>>
    <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.031 14.617L20.314 18.899L18.899 20.314L14.617 16.031C13.0237 17.3082 11.042 18.0029 9 18C4.032 18 0 13.968 0 9C0 4.032 4.032 0 9 0C13.968 0 18 4.032 18 9C18.0029 11.042 17.3082 13.0237 16.031 14.617ZM14.025 13.875C15.2941 12.5699 16.0029 10.8204 16 9C16 5.132 12.867 2 9 2C5.132 2 2 5.132 2 9C2 12.867 5.132 16 9 16C10.8204 16.0029 12.5699 15.2941 13.875 14.025L14.025 13.875ZM10.178 5.176C9.88313 5.3092 9.62498 5.51195 9.42569 5.76686C9.22641 6.02176 9.09195 6.32121 9.03384 6.63951C8.97574 6.95781 8.99573 7.28546 9.09209 7.59433C9.18846 7.90321 9.35832 8.18409 9.58712 8.41288C9.81591 8.64168 10.0968 8.81154 10.4057 8.90791C10.7145 9.00427 11.0422 9.02426 11.3605 8.96616C11.6788 8.90805 11.9782 8.77359 12.2331 8.57431C12.4881 8.37502 12.6908 8.11687 12.824 7.822C13.0868 8.67562 13.0563 9.59265 12.7375 10.427C12.4186 11.2613 11.8297 11.9648 11.0646 12.4256C10.2994 12.8864 9.40208 13.0778 8.51552 12.9694C7.62896 12.8609 6.8042 12.4589 6.17264 11.8274C5.54108 11.1958 5.13906 10.371 5.03064 9.48448C4.92223 8.59792 5.11365 7.70058 5.5744 6.93544C6.03516 6.1703 6.73875 5.58138 7.57305 5.26252C8.40735 4.94366 9.32438 4.9132 10.178 5.176Z" fill="#26547C"/>
</svg><?=$this->transEsc('history_saved_searches')?>
    </a>
  <?php endif; ?>
  <?php if ($user): ?>
    <a href="<?=$this->url('myresearch-logout')?>">
    <svg width="21" height="19" viewBox="0 0 21 19" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M16.25 10.45H8.65V8.55H16.25V5.7L21 9.5L16.25 13.3V10.45ZM17.2 3.8H14.6274C13.5305 2.83258 12.1777 2.20224 10.7313 1.98461C9.28501 1.76698 7.80662 1.97131 6.47355 2.57308C5.14048 3.17484 4.00937 4.14849 3.21594 5.37718C2.42251 6.60586 2.00048 8.0374 2.00048 9.5C2.00048 10.9626 2.42251 12.3941 3.21594 13.6228C4.00937 14.8515 5.14048 15.8252 6.47355 16.4269C7.80662 17.0287 9.28501 17.233 10.7313 17.0154C12.1777 16.7978 13.5305 16.1674 14.6274 15.2H17.2C16.3159 16.3807 15.1686 17.3389 13.8493 17.9986C12.53 18.6582 11.075 19.0011 9.6 19C4.35316 19 0.100006 14.7468 0.100006 9.5C0.100006 4.25315 4.35316 3.8147e-06 9.6 3.8147e-06C11.075 -0.00110435 12.53 0.341787 13.8493 1.00144C15.1686 1.66109 16.3159 2.61932 17.2 3.8Z" fill="#FF1D53"/>
</svg> <?=$this->transEsc("Log Out")?>
    </a>
  <?php endif; ?>
</div>

<?php if ($user && $this->userlist()->getMode() !== 'disabled'): ?>
  <h3><?=$this->transEsc('Your Lists')?></h3>
  <div class="myresearch-menu">
    <a href="<?=$this->url('myresearch-favorites')?>"<?=$this->active == 'favorites' ? ' class="active"' : ''?>>
    <svg width="22" height="21" viewBox="0 0 22 21" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M20.8096 7.23126L14.3629 6.29435L11.4811 0.451963C11.4024 0.292002 11.2729 0.162509 11.1129 0.0837985C10.7118 -0.114248 10.2243 0.0507907 10.0237 0.451963L7.14184 6.29435L0.695156 7.23126C0.517422 7.25665 0.354922 7.34044 0.230507 7.46739C0.0800975 7.62199 -0.00278512 7.82997 7.14643e-05 8.04565C0.00292805 8.26132 0.0912902 8.46703 0.245742 8.61759L4.91 13.1651L3.80805 19.5863C3.78221 19.7357 3.79874 19.8893 3.85576 20.0298C3.91279 20.1703 4.00803 20.2919 4.13068 20.381C4.25334 20.4701 4.3985 20.523 4.54971 20.5338C4.70092 20.5446 4.85212 20.5128 4.98617 20.442L10.7524 17.4104L16.5186 20.442C16.676 20.5258 16.8588 20.5537 17.034 20.5233C17.4758 20.4471 17.7729 20.0281 17.6967 19.5863L16.5948 13.1651L21.259 8.61759C21.386 8.49318 21.4698 8.33068 21.4952 8.15294C21.5637 7.70861 21.254 7.29728 20.8096 7.23126Z" fill="#26547C"/>
</svg> <?=$this->transEsc('Your Favorites')?>
    </a>
    <?php $lists = $user->getLists() ?>
    <?php
      // Use a variable so that we can output this nicely without whitespace that would get underlined:
      $publicInd = '<i class="fa fa-globe" title="' . $this->transEscAttr('public_list_indicator') . '">'
        . '</i> <span class="sr-only">(' . $this->transEsc('public_list_indicator') . ')</span>';
    ?>
    <?php foreach ($lists as $list): ?>
      <a class="user-list-link" href="<?=$this->url('userList', ['id' => $list['id']])?>"<?=$this->active == 'list' . $list['id'] ? ' class="active"' : ''?>>
        <?=$this->escapeHtml($list['title'])?><?=$list['public'] ? $publicInd : ''?>
        <span class="badge"><?=$list->cnt ?></span>
      </a>
    <?php endforeach; ?>
    <a href="<?=$this->url('editList', ['id' => 'NEW'])?>"<?=$this->active == 'editlist/NEW' ? ' class="active"' : ''?>>
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M6 6V0H8V6H14V8H8V14H6V8H0V6H6Z" fill="#2B310D"/>
</svg> <?=$this->transEsc('Create a List') ?>
    </a>
  </div>
<?php endif ?>
